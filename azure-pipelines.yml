# azure-pipelines.yml

trigger:
  branches:
    include:
      - main  # Trigger the pipeline when changes are pushed to the 'main' branch

pool:
  name: 'Default'  # Specify the name of your self-hosted agent pool

variables:
  mavenPOMFile: 'pom.xml'

steps:
  - task: Maven@3
    displayName: 'Maven package'
    inputs:
      mavenPomFile: '$(mavenPOMFile)'  # Use the defined variable for the POM file path
      goals: 'package'  # Execute Maven package goal to build the project

  - task: CopyFiles@2
    displayName: 'Copy Files to Artifact Staging Directory'
    inputs:
      SourceFolder: '$(System.DefaultWorkingDirectory)/target'  # Source folder where Maven built the artifacts
      Contents: '**/*.jar'  # Include all JAR files in the target folder
      TargetFolder: '$(Build.ArtifactStagingDirectory)'  # Copy JAR files to the artifact staging directory
    condition: succeededOrFailed()  # Execute this step regardless of previous steps' result

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'  # Publish artifacts from the staging directory
    condition: succeededOrFailed()  # Publish artifacts regardless of previous steps' result
